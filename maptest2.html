<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>mapTest</title>
<script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
<link rel="stylesheet" type="text/css" href="map.css">
<style></style>
</head>	
<body>
    <button onclick="resetAll()">Reset Selection</button>
    <button onclick="AssignRandomValues()">Assign Random Values</button>
    <button onclick="ShowPopulation()">show Population</button>
    <p id="p1">TestText</p>
    <div id="container" class="svg-container"></div>
    <script type="text/javascript">
    var w = 800;
    var h = 550;
    var svg = d3.select("div#container").append("svg").attr("preserveAspectRatio", "xMinYMin meet").style("background-color","#c9e8fd")
    .attr("viewBox", "0 0 " + w + " " + h)
    .classed("svg-content", true);
    var projection = d3.geoMercator().translate([w/2, h/2]).scale(2550).center([10,51.4]);
    var path = d3.geoPath().projection(projection);

  // load data  
var worldmap = d3.json("landkreise_simplify200.geojson");
var parsedCSV = null;
var dictCSV = {};	    
var inputCSV = d3.csv("test.csv").then(function(data)
    { parsedCSV = data;    
    });
	    	    
var pathDict = {};	    

//var cities = d3.csv("cities.csv");
	    	    
Promise.all([worldmap]).then(function(values){    
 // draw map
	
	for (var element of parsedCSV) 
	{
		dictCSV[element.AGS] = element.COVID;
  		console.log(element);
	}	
	
    svg.selectAll("path")
        .data(values[0].features)
        .enter()
        .append("path")
        .attr("class","region")
	.attr("status", "normal")
	.attr("category", "-1")
	.attr("name", function (d) {
        	return d.properties["GEN"];
    	})
	.attr("AGS", function (d) {
	    	pathDict[d.properties["AGS"]] = d3.select(this);
        	return d.properties["AGS"];
    	})
	.attr("COVID", function (d) {
	    	
	    	let k = parsedCSV[d.properties["AGS"]];
        	//return k;
    	})
	
	.attr("population", function (d) {
        	return d.properties["destatis"]["population"];
    	})
        .attr("d", path)
	.on("click", function() {        	
		let curVal = d3.select(this).attr("status");
	    	if(curVal !== "clicked") 
		{
			curVal = "clicked";
		}
	    	else
		{
			curVal = "normal";
		}
	    	d3.select(this).attr("status", curVal);
    		})
	.on("mouseover", function() {
	    	let friendlyName = d3.select(this).attr("name");
		let AGS = d3.select(this).attr("AGS");
	    	let pop = d3.select(this).attr("population");
		let cat = d3.select(this).attr("category");
		let regionInfo = friendlyName + "| " + AGS + "| " + pop + "| " + cat;
	    	
		d3.select("#p1").style("color", "green");
	    	d3.select("#p1").html(regionInfo);
		});
    });

function AssignRandomValues()
{	
	svg.selectAll("path")
	.attr("category", function() {
		return Math.floor(Math.random() * (5 - 1 + 1)) + 1;
	});
}
	    
function ShowPopulation()
{	
	svg.selectAll("path")
	.attr("category", function() {
		let p = d3.select(this).attr("population");
		let c = 1;
		if(p > 100000)
		{
			c = 2;
		}
		if( p > 200000)
		{
			c = 3;
		}
		if( p > 300000)
		{
			c = 4;
		}
		if( p > 400000)
		{
			c = 5;
		}
		return c;
	});
}
	    
	  
	        
function resetAll()
{
	svg.selectAll("path")
	.attr("status", "normal")
	.attr("category", null);	
	d3.select("#p1").html("TestText");
};
	    
</script>
</body>
</html>
